{
  "project": "Personal Finances",
  "branchName": "ralph/retirement-planner",
  "description": "Retirement Planner - Project financial future with 3%/4% safe withdrawal rules, scenario comparison, net worth growth projections, and inflation adjustments",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create retirement planner database models",
      "description": "As a developer, I need database models to store retirement plan data so it persists across sessions.",
      "acceptanceCriteria": [
        "Create `retirement_plans` table with fields: id (UUID), name (String), target_retirement_date (Date nullable), starting_net_worth (f64), monthly_contribution (f64), expected_monthly_expenses (f64), return_scenario (TEXT: 'conservative'/'moderate'/'aggressive'), inflation_rate (f64, default 0.0), created_at, updated_at",
        "Add SQLx migration file in src-tauri/migrations/",
        "Add RetirementPlan struct to src-tauri/src/models.rs following existing patterns",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Create RetirementService with calculation logic",
      "description": "As a user, I want the app to calculate my retirement projections so I can understand my financial trajectory.",
      "acceptanceCriteria": [
        "Create src-tauri/src/services/retirement.rs following existing service patterns",
        "Implement compound growth formula: FV = PV * (1 + r)^n + PMT * (((1 + r)^n - 1) / r)",
        "Support three return scenarios: conservative (4%), moderate (7%), aggressive (10%) annual returns",
        "Calculate sustainable monthly income using both 3% and 4% annual withdrawal rules",
        "Calculate years to reach retirement goal (target net worth = annual_expenses / withdrawal_rate)",
        "Add mod retirement to src-tauri/src/services/mod.rs",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Add unit tests for retirement calculations",
      "description": "As a developer, I need unit tests to verify retirement calculation accuracy.",
      "acceptanceCriteria": [
        "Add tests module in src-tauri/src/services/retirement.rs",
        "Test compound growth calculation with known values",
        "Test 3% and 4% withdrawal rate calculations",
        "Test all three return scenarios (conservative/moderate/aggressive)",
        "Test edge case: retirement already achievable",
        "Tests pass (cargo test)",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create CRUD Tauri commands for retirement plans",
      "description": "As a frontend developer, I need Tauri commands to create, read, update, delete retirement plans.",
      "acceptanceCriteria": [
        "Add create_retirement_plan command - creates new plan, returns created plan",
        "Add get_retirement_plans command - returns all saved plans (max 3)",
        "Add get_retirement_plan command - returns single plan by ID",
        "Add update_retirement_plan command - updates plan by ID",
        "Add delete_retirement_plan command - removes plan by ID",
        "Register all commands in src-tauri/src/main.rs",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create get_latest_net_worth command",
      "description": "As a frontend developer, I need a command to fetch the most recent net worth for pre-populating the retirement form.",
      "acceptanceCriteria": [
        "Add get_latest_net_worth command that returns most recent NetWorthDataPoint",
        "Uses NetWorthService::get_history() and returns last entry sorted by year/month",
        "Returns None/null if no balance sheet data exists",
        "Register command in src-tauri/src/main.rs",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create calculate_retirement_projection command",
      "description": "As a frontend developer, I need a command to calculate retirement projections from plan inputs.",
      "acceptanceCriteria": [
        "Add calculate_retirement_projection command that accepts plan inputs",
        "Returns projection results: projected_retirement_date, years_to_retirement, final_net_worth, monthly_income_3pct, monthly_income_4pct",
        "Uses RetirementService calculation methods",
        "Register command in src-tauri/src/main.rs",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Add TypeScript types for retirement planner",
      "description": "As a frontend developer, I need TypeScript types matching the Rust models.",
      "acceptanceCriteria": [
        "Add RetirementPlan interface to src/lib/types.ts with inflationRate field",
        "Add RetirementProjection interface with projection result fields including inflationAdjustedExpenses",
        "Add ReturnScenario type: 'conservative' | 'moderate' | 'aggressive'",
        "Types match Rust struct field names (camelCase)",
        "Typecheck passes (pnpm run typecheck)"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Add retirement planner route and navigation",
      "description": "As a user, I want to access the retirement planner from the app navigation.",
      "acceptanceCriteria": [
        "Add /retirement route to React router",
        "Create src/pages/Retirement.tsx page component with placeholder content",
        "Add 'Retirement Planner' link to main navigation/sidebar",
        "Navigation highlights when on /retirement route",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Create retirement plan input form",
      "description": "As a user, I want to enter my retirement planning inputs so I can generate projections.",
      "acceptanceCriteria": [
        "Form includes: plan name (text), target retirement date (optional date picker), monthly contribution (number), expected monthly expenses (number)",
        "Return scenario selector with options: Conservative (4%), Moderate (7%), Aggressive (10%)",
        "Inflation rate input field (optional number, defaults to 0%, range 0-15%)",
        "Starting net worth field that fetches and pre-populates from get_latest_net_worth command",
        "Starting net worth is editable (user can override)",
        "Form validation: all monetary values must be positive, expenses required, inflation rate 0-15%",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Display retirement projection results",
      "description": "As a user, I want to see my retirement projections so I can understand my financial future.",
      "acceptanceCriteria": [
        "Display projected retirement date (or 'Already achievable' if current savings sufficient)",
        "Display years until retirement",
        "Display projected net worth at retirement",
        "Display sustainable monthly income under 3% rule",
        "Display sustainable monthly income under 4% rule",
        "When inflation rate > 0, display inflation-adjusted expenses at retirement date",
        "Highlight if projected income meets/exceeds expected expenses (green) or falls short (amber/red), using inflation-adjusted expenses when applicable",
        "Results call calculate_retirement_projection and update when form inputs change",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Add save plan functionality",
      "description": "As a user, I want to save my retirement plan so I can compare scenarios later.",
      "acceptanceCriteria": [
        "Save button calls create_retirement_plan command",
        "Shows success message after saving",
        "Enforces max 3 scenarios limit - shows message if limit reached",
        "Saved plan appears in scenario list",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Implement scenario comparison view",
      "description": "As a user, I want to compare up to 3 retirement scenarios side-by-side.",
      "acceptanceCriteria": [
        "Display saved scenarios in a comparison table/grid below the form",
        "Show key metrics: name, retirement date, years remaining, monthly income (3%), monthly income (4%), inflation rate",
        "Visual indicator (badge/icon) showing which scenario reaches retirement earliest",
        "Visual indicator showing which scenario provides highest sustainable income",
        "Delete button on each scenario row calls delete_retirement_plan",
        "Empty state message when no scenarios saved",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 12,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Handle edge cases and error states",
      "description": "As a user, I want clear feedback when calculations aren't possible or inputs are invalid.",
      "acceptanceCriteria": [
        "Show message when no balance sheet data exists ('Enter starting net worth manually')",
        "Handle case where retirement is not achievable with current inputs (show warning message)",
        "Show loading state while Tauri commands are processing",
        "Display error messages for failed Tauri commands",
        "All monetary values display in home currency from user settings",
        "Typecheck passes (pnpm run typecheck and cargo clippy)"
      ],
      "priority": 13,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Add retirement plan projections table",
      "description": "As a developer, I need to store net worth projection data points for charting.",
      "acceptanceCriteria": [
        "Create `retirement_plan_projections` table with fields: id (UUID), plan_id (FK to retirement_plans), year (i32), month (i32), projected_net_worth (f64), created_at",
        "Add SQLx migration file in src-tauri/migrations/",
        "Add RetirementPlanProjection struct to src-tauri/src/models.rs",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 14,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Generate and store projection data points",
      "description": "As a user, I want my net worth growth projections stored so I can view them in a chart.",
      "acceptanceCriteria": [
        "RetirementService generates monthly projection data points from current date to retirement date",
        "Projection data points are saved to retirement_plan_projections table when plan is created/updated",
        "Old projection data points are deleted and replaced when plan inputs change",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 15,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Add get_retirement_plan_projections command",
      "description": "As a frontend developer, I need a command to fetch projection data points for charting.",
      "acceptanceCriteria": [
        "Add get_retirement_plan_projections command that accepts plan_id",
        "Returns list of projection data points sorted by year/month ascending",
        "Register command in src-tauri/src/main.rs",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 16,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Add TypeScript types for projection data",
      "description": "As a frontend developer, I need TypeScript types for projection data points.",
      "acceptanceCriteria": [
        "Add RetirementPlanProjection interface to src/lib/types.ts with fields: id, planId, year, month, projectedNetWorth, createdAt",
        "Typecheck passes (pnpm run typecheck)"
      ],
      "priority": 17,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Implement target date mode calculations",
      "description": "As a user, I want projections for my specified target date, not just earliest possible date.",
      "acceptanceCriteria": [
        "When target_retirement_date is set, calculate projections for that specific date",
        "When target_retirement_date is null/cleared, fall back to earliest possible retirement date",
        "Projected net worth and sustainable income are calculated based on the selected retirement date",
        "Unit tests cover both target date mode and discovery mode",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 18,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Display net worth growth chart",
      "description": "As a user, I want to see a chart of my projected net worth growth over time.",
      "acceptanceCriteria": [
        "Add line chart showing net worth growth from current date to retirement date",
        "Chart uses data from get_retirement_plan_projections command",
        "Chart displays yearly data points (aggregate monthly data)",
        "Chart clearly marks the retirement date on the timeline",
        "Chart updates when form inputs change and projections are recalculated",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 19,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Update results display for target date mode",
      "description": "As a user, I want to see whether I'm viewing projections for my target date or earliest possible date.",
      "acceptanceCriteria": [
        "Display which mode is active: 'Target Date' or 'Earliest Possible'",
        "When target date is set, show 'Projections for [date]' header",
        "When target date is cleared, show 'Earliest Retirement: [date]' header",
        "Results and chart update immediately when target date is set or cleared",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 20,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Add load scenario functionality",
      "description": "As a user, I want to load a saved scenario to view its details and chart.",
      "acceptanceCriteria": [
        "Clicking a saved scenario in comparison view loads it into the main form",
        "Form inputs are populated with the loaded scenario's values",
        "Results and chart update to show the loaded scenario's projections",
        "Visual indicator (highlight/border) shows which scenario is currently loaded",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 21,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Add inflation_rate column migration",
      "description": "As a developer, I need to add inflation_rate to existing retirement_plans table.",
      "acceptanceCriteria": [
        "Add SQLx migration to add inflation_rate column (REAL, default 0.0) to retirement_plans table",
        "Migration runs successfully on existing database",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 22,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Update RetirementPlan model with inflation_rate",
      "description": "As a developer, I need to update the Rust model to include inflation_rate.",
      "acceptanceCriteria": [
        "Add inflation_rate: f64 field to RetirementPlan struct in src-tauri/src/models.rs",
        "Update all CRUD queries in retirement commands to include inflation_rate",
        "Update create_retirement_plan, update_retirement_plan commands to accept inflation_rate",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 23,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Implement inflation-adjusted expense calculations",
      "description": "As a user, I want my retirement expenses adjusted for inflation over time.",
      "acceptanceCriteria": [
        "RetirementService calculates inflation-adjusted expenses: Adjusted = Current Ã— (1 + rate)^years",
        "Inflation adjustment applied when calculating target net worth for retirement",
        "Inflation adjustment applied when comparing sustainable income to expenses",
        "Unit tests cover inflation calculation scenarios",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 24,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-025",
      "title": "Update calculate_retirement_projection to return inflation-adjusted values",
      "description": "As a frontend developer, I need the projection command to return inflation-adjusted data.",
      "acceptanceCriteria": [
        "calculate_retirement_projection returns inflation_adjusted_expenses field",
        "When inflation_rate is 0, inflation_adjusted_expenses equals original expenses",
        "Typecheck passes (cargo clippy)"
      ],
      "priority": 25,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Update TypeScript types for inflation",
      "description": "As a frontend developer, I need TypeScript types updated for inflation support.",
      "acceptanceCriteria": [
        "Add inflationRate field to RetirementPlan interface in src/lib/types.ts",
        "Add inflationAdjustedExpenses field to RetirementProjection interface",
        "Typecheck passes (pnpm run typecheck)"
      ],
      "priority": 26,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "Add inflation rate input to form",
      "description": "As a user, I want to enter an inflation rate for my retirement plan.",
      "acceptanceCriteria": [
        "Add inflation rate number input field to retirement form (defaults to 0)",
        "Input validation: must be between 0 and 15 (percent)",
        "Form passes inflation_rate to create/update commands",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 27,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-028",
      "title": "Display inflation-adjusted expenses in results",
      "description": "As a user, I want to see how inflation affects my retirement expenses.",
      "acceptanceCriteria": [
        "When inflation rate > 0, show 'Inflation-adjusted expenses at retirement: $X/month'",
        "Show both current and adjusted expenses for comparison",
        "Income comparison (meets/exceeds) uses inflation-adjusted expenses",
        "Typecheck passes (pnpm run typecheck)",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 28,
      "passes": false,
      "notes": ""
    }
  ]
}
